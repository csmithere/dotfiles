# True color support
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Undercurl support (for nvim LSP diagnostics)
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'egel/tmux-gruvbox'

# Gruvbox theme settings
set -g @tmux-gruvbox 'dark'

# Resurrect settings
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session'

# Continuum settings - auto-save every 15 min
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Prefix highlight is integrated into the theme status bar

# Lower escape time for snappy nvim experience
set -sg escape-time 10

# Enable focus events for nvim autoread
set -g focus-events on

# Scrollback buffer
set -g history-limit 50000

# Start numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# remap prefix to C-Space
unbind C-b
set-option -g prefix C-Space
bind-key C-Space send-prefix

# split panes using | and - (in current path)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# split panes in direction with prefix + Shift + Arrow (in current path)
bind S-Left split-window -hb -c "#{pane_current_path}"
bind S-Right split-window -h -c "#{pane_current_path}"
bind S-Up split-window -vb -c "#{pane_current_path}"
bind S-Down split-window -v -c "#{pane_current_path}"

# reload config file
bind r source-file ~/.tmux.conf

# Enable mouse control (clickable windows, panes, resizable panes)
set -g mouse on

# Vi-style copy mode
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel
set -g set-clipboard on

# New window in current path (with auto-rename so ad-hoc windows show the running command)
bind c new-window -c "#{pane_current_path}" \; set-window-option automatic-rename on

# Pane display time
set -g display-panes-time 2000

# Window swapping
bind -r < swap-window -t -1\; select-window -t -1
bind -r > swap-window -t +1\; select-window -t +1

# Session switching
bind s choose-tree -sZ

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity off

# switch panes using Alt-arrow without prefix
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Auto-rename format: show running command, or directory name when at a shell prompt
# Automatic-rename is off by default so tmuxinator window names stick;
# ad-hoc windows (prefix+c) enable it per-window
set -g automatic-rename-format '#{?#{==:#{pane_current_command},fish},#{b:pane_current_path},#{pane_current_command}}'

# Editor split: prefix + e opens nvim in a vertical split with file tree
bind e split-window -h -c "#{pane_current_path}" "nvim ."

# Initialize TPM (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
